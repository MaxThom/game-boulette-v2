@page "/lobby/{gamecode}"
@inherits AppBaseComponent
@inject IJSRuntime js
@inject NavigationManager NavigationManager
@inject GameHubService GameHub

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-16">
    <MudText Typo="Typo.h3" Align="Align.Center" GutterBottom="true"><strong>@game.Name</strong></MudText>
    <MudText Align="Align.Center">@LanguageManager.CurrentLanguage.GameLobbyPage.Description</MudText>

    <MudGrid Class="" Justify="Justify.Center">
        <MudItem xs="12" sm="12" md="12">
                <MudField Class="mx-4 mt-4 mb-n5" Margin="Margin.Dense" Label="@LanguageManager.CurrentLanguage.GameLobbyPage.GameUrl" Variant="Variant.Outlined" Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.ContentCopy" OnAdornmentClick="OnCopyGameUrl">localhost:5001/lobby/24f8bds34d=</MudField>
        </MudItem>
    </MudGrid>
    <MudGrid Class="mt-8" Justify="Justify.Center">        
        <MudItem xs="12" sm="6" md="6" >
            <MudPaper Elevation="25" Class="rounded-lg pb-4 mb-2 d-flex flex-column" Style="min-height:600px;">
                <MudItem Class="d-flex flex-row justify-start pt-5 pb-3 px-5">
                    <MudText Class="mt-1" style="font-size: 1em;" Typo="Typo.overline">@LanguageManager.CurrentLanguage.GameLobbyPage.ThemeLabel</MudText>
                    <MudText Class="my-auto" style="font-size: 1.5em;" Typo="Typo.body1"><strong>@game.Theme</strong></MudText>
                </MudItem>                
                <MudText Class="px-5" Typo="Typo.h6">@LanguageManager.CurrentLanguage.GameLobbyPage.EnterWords</MudText>
                <MudItem Class="d-flex flex-row justify-start px-8"> 
                    <MudText Class="mt-3" style="font-size: 1em;" Typo="Typo.overline">@LanguageManager.CurrentLanguage.GameLobbyPage.Word #1:&nbsp;&nbsp;&nbsp;</MudText>
                    <MudTextField Class="my-auto" Style="" @bind-Value="TeamNameOne" Variant="Variant.Text" />                     
                </MudItem>
                <MudItem Class="d-flex flex-row justify-start px-8"> 
                    <MudText Class="mt-3" style="font-size: 1em;" Typo="Typo.overline">@LanguageManager.CurrentLanguage.GameLobbyPage.Word #2:&nbsp;&nbsp;&nbsp;</MudText>
                    <MudTextField Class="my-auto" Style="" @bind-Value="TeamNameOne" Variant="Variant.Text" />                     
                </MudItem>
                <MudItem Class="d-flex flex-row justify-start px-8"> 
                    <MudText Class="mt-3" style="font-size: 1em;" Typo="Typo.overline">@LanguageManager.CurrentLanguage.GameLobbyPage.Word #3:&nbsp;&nbsp;&nbsp;</MudText>
                    <MudTextField Class="my-auto" Style="" @bind-Value="TeamNameOne" Variant="Variant.Text" />                     
                </MudItem>
                <MudItem Class="d-flex flex-row justify-start px-8"> 
                    <MudText Class="mt-3" style="font-size: 1em;" Typo="Typo.overline">@LanguageManager.CurrentLanguage.GameLobbyPage.Word #4:&nbsp;&nbsp;&nbsp;</MudText>
                    <MudTextField Class="my-auto" Style="" @bind-Value="TeamNameOne" Variant="Variant.Text" />                     
                </MudItem>
                <MudItem Class="d-flex flex-row justify-start px-8"> 
                    <MudText Class="mt-3" style="font-size: 1em;" Typo="Typo.overline">@LanguageManager.CurrentLanguage.GameLobbyPage.Word #5:&nbsp;&nbsp;&nbsp;</MudText>
                    <MudTextField Class="my-auto" Style="" @bind-Value="TeamNameOne" Variant="Variant.Text" />                     
                </MudItem>
                <MudItem Class="d-flex flex-row justify-start px-8"> 
                    <MudText Class="mt-3" style="font-size: 1em;" Typo="Typo.overline">@LanguageManager.CurrentLanguage.GameLobbyPage.Word #6:&nbsp;&nbsp;&nbsp;</MudText>
                    <MudTextField Class="my-auto" Style="" @bind-Value="TeamNameOne" Variant="Variant.Text" />                     
                </MudItem>
                <MudItem Class="d-flex flex-row justify-start px-8"> 
                    <MudText Class="mt-3" style="font-size: 1em;" Typo="Typo.overline">@LanguageManager.CurrentLanguage.GameLobbyPage.Word #7:&nbsp;&nbsp;&nbsp;</MudText>
                    <MudTextField Class="my-auto" Style="" @bind-Value="TeamNameOne" Variant="Variant.Text" />                     
                </MudItem>
                <MudItem Class="d-flex flex-row justify-start px-8"> 
                    <MudText Class="mt-3" style="font-size: 1em;" Typo="Typo.overline">@LanguageManager.CurrentLanguage.GameLobbyPage.Word #8:&nbsp;&nbsp;&nbsp;</MudText>
                    <MudTextField Class="my-auto" Style="" @bind-Value="TeamNameOne" Variant="Variant.Text" />                     
                </MudItem>
                <MudItem Class="d-flex flex-row justify-end px-8 py-5 mt-auto">                     
                    <MudButton Variant="Variant.Text" Color="Color.Warning" Disabled="true" Class="pa-2 mr-2">@LanguageManager.CurrentLanguage.GameLobbyPage.NotReady</MudButton>
                    <MudButton Variant="Variant.Text" Color="Color.Success" Disabled="false" Class="pa-2 mr-2" OnClick="OnReady">@LanguageManager.CurrentLanguage.GameLobbyPage.Ready</MudButton>
                    @if (IsHost)
                    {
                        <MudButton Variant="Variant.Text" Color="Color.Tertiary" Disabled="false" Class="pa-2" OnClick="NavigateToGameComponent">@LanguageManager.CurrentLanguage.GameLobbyPage.StartGame</MudButton>         
                    }
                </MudItem>
            </MudPaper>            
        </MudItem>
        <MudItem xs="12" sm="6" md="6">
            <MudItem Style="min-height:300px;">
                <MudItem Class="">
                    <MudPaper Elevation="25" Class="rounded-lg py-2 px-2">
                        <MudGrid Class="" Justify="Justify.Center">        
                            <MudItem xs="12" sm="12" md="6">
                                @if (IsHost)
                                {
                                    <MudTextField Class="" Style="" @bind-Value="TeamNameOne" Label="@LanguageManager.CurrentLanguage.GameLobbyPage.TeamNameOne" Variant="Variant.Outlined" Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.Edit" OnAdornmentClick="OnTeamOneEdit" />
                                }
                                else 
                                {
                                    <MudText Class="" Style="" Typo="Typo.h6">@(TeamNameOne.Length > 10 ? TeamNameOne.Substring(0, 15) + " ..." : TeamNameOne)</MudText>
                                }
                            </MudItem>
                            <MudItem xs="12" sm="12" md="6">
                                <MudButton Class="ml-n2 mt-4" Variant="Variant.Filled" Color="Color.Default" FullWidth="true">@LanguageManager.CurrentLanguage.GameLobbyPage.JoinTeam</MudButton>
                            </MudItem>
                        </MudGrid>
                    </MudPaper>
                </MudItem>
                <MudItem Class="d-flex flex-row justify-start flex-wrap py-2 px-1">
                    <MudButton Class="pa-2 ma-2" Variant="Variant.Outlined" Color="Color.Tertiary">MaxThom</MudButton>
                    <MudButton Class="pa-2 ma-2" Variant="Variant.Outlined" Color="Color.Primary">MaxThom</MudButton>
                    <MudButton Class="pa-2 ma-2" Variant="Variant.Filled" Color="Color.Secondary">MaxThom</MudButton>
                    <MudButton Class="pa-2 ma-2" Variant="Variant.Outlined" Color="Color.Warning">MaxThom</MudButton>
                    <MudButton Class="pa-2 ma-2" Variant="Variant.Outlined" Color="Color.Tertiary">MaxThom</MudButton>
                    <MudButton Class="pa-2 ma-2" Variant="Variant.Outlined" Color="Color.Primary">MaxThom</MudButton>
                    <MudButton Class="pa-2 ma-2" Variant="Variant.Outlined" Color="Color.Secondary">MaxThom</MudButton>
                    <MudButton Class="pa-2 ma-2" Variant="Variant.Outlined" Color="Color.Warning">MaxThom</MudButton>
                </MudItem>
            </MudItem>
            <MudItem Style="min-height:300px;">
                <MudItem Class="">
                    <MudPaper Elevation="25" Class="rounded-lg py-2 px-2">
                        <MudGrid Class="" Justify="Justify.Center">        
                            <MudItem xs="12" sm="12" md="6">
                                @if (IsHost)
                                {
                                    <MudTextField Class="" Style="" @bind-Value="TeamNameTwo" Label="@LanguageManager.CurrentLanguage.GameLobbyPage.TeamNameTwo" Variant="Variant.Outlined" Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.Edit" OnAdornmentClick="OnTeamTwoEdit" />
                                }
                                else 
                                {
                                    <MudText Class="" Style="" Typo="Typo.h6">@(TeamNameTwo.Length > 10 ? TeamNameTwo.Substring(0, 15) + " ..." : TeamNameTwo)</MudText>
                                }
                            </MudItem>
                            <MudItem xs="12" sm="12" md="6">
                                <MudButton Class="ml-n2 mt-4" Variant="Variant.Filled" Color="Color.Default" FullWidth="true">@LanguageManager.CurrentLanguage.GameLobbyPage.JoinTeam</MudButton>
                            </MudItem>
                        </MudGrid>
                    </MudPaper>
                </MudItem>
                <MudItem Class="d-flex flex-row justify-start flex-wrap py-2 px-1">
                    <MudButton Class="pa-2 ma-2" Variant="Variant.Outlined" Color="Color.Tertiary">MaxThom</MudButton>
                    <MudButton Class="pa-2 ma-2" Variant="Variant.Outlined" Color="Color.Primary">MaxThom</MudButton>
                    <MudButton Class="pa-2 ma-2" Variant="Variant.Outlined" Color="Color.Secondary">MaxThom</MudButton>
                    <MudButton Class="pa-2 ma-2" Variant="Variant.Outlined" Color="Color.Warning">MaxThom</MudButton>
                    <MudButton Class="pa-2 ma-2" Variant="Variant.Outlined" Color="Color.Tertiary">MaxThom</MudButton>
                    <MudButton Class="pa-2 ma-2" Variant="Variant.Outlined" Color="Color.Primary">MaxThom</MudButton>
                    <MudButton Class="pa-2 ma-2" Variant="Variant.Outlined" Color="Color.Secondary">MaxThom</MudButton>
                    <MudButton Class="pa-2 ma-2" Variant="Variant.Outlined" Color="Color.Warning">MaxThom</MudButton>
                </MudItem>
            </MudItem>
        </MudItem>
    </MudGrid>
    <MudGrid Class="" Justify="Justify.Center">
        <MudItem xs="12" sm="12" md="12">
            <MudExpansionPanels>
                <MudExpansionPanel>
                    <TitleContent>
                        <MudItem class="d-flex">
                            <MudIcon Icon="@Icons.Material.Filled.Settings" class="mr-3"></MudIcon>
                            <MudText>@LanguageManager.CurrentLanguage.GameLobbyPage.ConfigurationLabel</MudText>
                        </MudItem>
                    </TitleContent>
                    <ChildContent>
                        <MudForm @ref="form" @bind-IsValid="@success" @bind-Errors="@errors" Class="d-flex flex-row justify-center flex-wrap py-1 px-1">
                            <MudTextField Class="pa-1 ma-1" T="string" ReadOnly="@(!IsHost)" Margin="Margin.Dense" @bind-Value="game.Name" Label="@LanguageManager.CurrentLanguage.CreateGamePage.GameName" Variant="Variant.Outlined" Required="true" RequiredError="@LanguageManager.CurrentLanguage.CreateGamePage.MissingField" />
                            <MudTextField Class="pa-1 ma-1" T="string" ReadOnly="@(!IsHost)" Margin="Margin.Dense" @bind-Value="game.Theme" Label="@LanguageManager.CurrentLanguage.CreateGamePage.GameTheme" Variant="Variant.Outlined" />            
                            <MudNumericField Class="pa-1 ma-1" ReadOnly="@(!IsHost)" Margin="Margin.Dense" @bind-Value="game.NumberOfRound" Label="@LanguageManager.CurrentLanguage.CreateGamePage.NumberOfRound" Variant="Variant.Outlined" Adornment="Adornment.End" AdornmentText="@LanguageManager.CurrentLanguage.CreateGamePage.Rounds" Required="true" RequiredError="@LanguageManager.CurrentLanguage.CreateGamePage.MissingField"/> 
                            <MudNumericField Class="pa-1 ma-1" ReadOnly="@(!IsHost)" Margin="Margin.Dense" @bind-Value="game.TimePerTurn" Label="@LanguageManager.CurrentLanguage.CreateGamePage.TimePerTurn" Variant="Variant.Outlined" Adornment="Adornment.End" AdornmentText="@LanguageManager.CurrentLanguage.CreateGamePage.Seconds" Required="true" RequiredError="@LanguageManager.CurrentLanguage.CreateGamePage.MissingField"/>                        
                            <MudNumericField Class="pa-1 ma-1" ReadOnly="@(!IsHost)" Margin="Margin.Dense" @bind-Value="game.NumberOfPaperPerPerson" Label="@LanguageManager.CurrentLanguage.CreateGamePage.NumberOfPaper" Variant="Variant.Outlined" Adornment="Adornment.End" AdornmentText="@LanguageManager.CurrentLanguage.CreateGamePage.Papers" Required="true" RequiredError="@LanguageManager.CurrentLanguage.CreateGamePage.MissingField"/>                        
                            <MudTextField T="string" Class="pa-1 ma-1" ReadOnly="@(!IsHost)" Margin="Margin.Dense" @bind-Value="game.VideoUrl" Label="@LanguageManager.CurrentLanguage.CreateGamePage.VideoURL" Variant="Variant.Outlined" Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.ContentCopy" OnAdornmentClick="OnCopyVideoUrl"/>                        
                            <MudField Class="pa-1 ma-1" Label="@LanguageManager.CurrentLanguage.GameLobbyPage.GameUrl" Margin="Margin.Dense" Variant="Variant.Outlined" Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.ContentCopy" OnAdornmentClick="OnCopyGameUrl">localhost:5001/lobby/24f8bds34d=</MudField>
                        </MudForm>
                    </ChildContent>                    
                </MudExpansionPanel>
                <MudExpansionPanel>
                    <TitleContent>
                        <MudItem class="d-flex">
                            <MudIcon Icon="@Icons.Material.Filled.Accessibility" class="mr-3"></MudIcon>
                            <MudText>@LanguageManager.CurrentLanguage.GameLobbyPage.RulesLabel</MudText>
                        </MudItem>
                    </TitleContent>
                    <ChildContent>
                        <MudText Typo="Typo.body1">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. </MudText>
                    </ChildContent>                    
                </MudExpansionPanel>
            </MudExpansionPanels>
        </MudItem>
    </MudGrid>
    <MudGrid Class="" Justify="Justify.Center">
        <MudItem xs="12" sm="12" md="12">
            <MudButton Variant="Variant.Outlined" Color="Color.Tertiary" OnClick="NavigateToIndexComponent" Class="pa-2 ml-2 mr-auto">@LanguageManager.CurrentLanguage.GameLobbyPage.Leave</MudButton>
        </MudItem>
    </MudGrid>
</MudContainer>

@code {
    [Parameter]
    public string GameCode { get; set; }
    public bool IsHost { get; set; } = true;
    public string TeamNameOne { get; set; } = "Équipe #1";
    public string TeamNameTwo { get; set; } = "Équipe #2";
    bool success;
    string[] errors = { };
    MudForm form;

    Configuration game = new Configuration()
    {
        Name = "Partie de Bob",
        Theme = "Tout",
        NumberOfRound = 3,
        TimePerTurn = 60,
        NumberOfPaperPerPerson = 5,      
        VideoUrl = "zoom.com/312dsd2g="
    };

    protected override void OnParametersSet()
    {
        GameCode = GameCode ?? "";
    }

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        await GameHub.ConnectToGameHub();
        Console.WriteLine(GameHub.IsConnected);
    }

    async void OnReady()
    {
        await GameHub.Send("MaxThom", "Hello old friend !");
    }

    void OnTeamOneEdit()
    {
    }

    void OnTeamTwoEdit()
    {
    }

    void OnCopyGameUrl() 
    {
        Console.WriteLine("Copy");
    }

    void OnCopyVideoUrl() 
    {
        Console.WriteLine("Copy");
    }

    private void NavigateToIndexComponent()
    {
        NavigationManager.NavigateTo("/");
    }

    private void NavigateToGameComponent()
    {
        NavigationManager.NavigateTo($"/game/{GameCode}");
    }
}
